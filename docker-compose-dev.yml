# Start ExplorViz with latest development changes
# Monitored applications can be connected

version: "3.2"
services:

  id-generator:
    image: redis
    container_name: explorviz-id-generator
    command: ["redis-server", "--appendonly", "yes"]
    expose:
      - "6379"
    volumes:
      - explorviz-id-generator-data:/data

  mongo-auth:
    image: mongo
    container_name: explorviz-backend-auth-mongo
    command: mongod --port 27017
    volumes:
       - explorviz-auth-mongo-data:/data/db
       - explorviz-auth-mongo-configdb:/data/configdb
    expose:
      - "27017"

  mongo-landscape:
    image: mongo
    container_name: explorviz-landscape-mongo
    command: mongod --port 27018
    volumes:
       - explorviz-landscape-mongo-data:/data/db
       - explorviz-landscape-mongo-configdb:/data/configdb
    expose:
      - "27018"

  user-service:
    image: explorviz/explorviz-backend-user-service:dev
    container_name: explorviz-backend-user-service
    depends_on:
      - mongo-auth
    environment:
      - MONGO_HOST=mongo-auth
      - REDIS_HOST=id-generator
    depends_on:
      - id-generator

  landscape-service:
    image: explorviz/explorviz-backend-landscape-service:dev
    container_name: explorviz-backend-landscape-service
    expose:
      - "10135"
    depends_on:
      - mongo-landscape
    environment:
      - MONGO_HOST=mongo-landscape
      - REDIS_HOST=id-generator
    depends_on:
      - id-generator

  analysis-service:
    image: explorviz/explorviz-backend-analysis-service:dev
    container_name: explorviz-backend-analysis-service
    ports:
      - "10133:10133"

  discovery-service:
    image: explorviz/explorviz-backend-discovery-service:dev
    container_name: explorviz-backend-discovery-service
    ports:
      - "8083:8083"
    depends_on:
      - id-generator

  frontend:
    image: explorviz/explorviz-frontend:dev
    container_name: explorviz-frontend
    ports:
      - "8090:80"
    environment:
      - API_ROOT=http://localhost:8090
    depends_on:
      - discovery-service
      - landscape-service
      - analysis-service
      - user-service

volumes:
  explorviz-auth-mongo-data:
  explorviz-auth-mongo-configdb:
  explorviz-landscape-mongo-data:
  explorviz-landscape-mongo-configdb:
  explorviz-id-generator-data: